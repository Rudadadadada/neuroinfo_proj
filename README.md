# Система диагностики заболеваний легких на основе рентгеновских снимков

<img width="460" alt="Screenshot 2025-01-07 at 18 39 50" src="https://github.com/user-attachments/assets/e009a7c9-f1f6-4375-b021-a0a9df409d04" />

## Try it here

Сервер развернут в [cloud.ru](https://cloud.ru/) на ВМке (ID c28e341c-a4eb-496c-8b0b-527b72b46c5f). Здесь можно попробовать диагностировать болезнь: http://176.108.255.249:5001/

## Подробное описание проекта
Система представляет собой комплексное программное решение, предназначенное для автоматизированного анализа рентгеновских снимков легких с целью выявления различных патологий. Основной функционал системы включает:

- Прием и обработку цифровых рентгеновских изображений в форматах DICOM, JPEG, PNG
- Предварительную обработку изображений
- Анализ снимков с помощью глубокой нейронной сети
- Формирование отчета о выявленных патологиях

## Бизнес цели

### Сокращение времени диагностики
- Уменьшение времени первичного анализа снимков с 15-20 минут до 1-2 минут
- Автоматизация рутинных процессов классификации снимков
- Приоритизация случаев, требующих немедленного внимания врача

### Оптимизация работы медицинского персонала
- Сокращение нагрузки на рентгенологов на 40-60%
- Автоматизация создания отчетов о результатах анализа
- Помощь в принятии решений для молодых специалистов

### Повышение качества диагностики
- Снижение влияния человеческого фактора на результаты анализа
- Стандартизация процесса диагностики
- Обеспечение воспроизводимости результатов

### Улучшение доступности диагностики
- Обеспечение удаленной диагностики для регионов без штатных рентгенологов
- Сокращение времени ожидания результатов анализа
- Снижение стоимости диагностики

## ML цели

### Точность модели
- Достижение общей точности классификации выше 90%
- Обеспечение чувствительности (recall) не менее 95% для критических патологий
- Поддержание специфичности на уровне не менее 85%

### Минимизация ошибок
- Снижение доли ложноположительных результатов до менее 5%
- Обеспечение ложноотрицательных результатов не более 2% для критических случаев
- Внедрение системы оценки уверенности в результатах

### Интерпретируемость
- Реализация тепловых карт активации (heatmaps)
- Предоставление вероятностных оценок для каждого типа патологии
- Документирование причин принятия решений моделью

### Мультизадачность
- Одновременное определение до 14 различных патологий
- Ранжирование патологий по степени выраженности
- Определение взаимосвязей между различными патологиями

## Архитектура системы (C4 model)

### Container Level
[Web Interface (Flask)] --> [Image Processor] --> [ML Model (DenseNet)] --> [Response Formatter]

## Выбор используемого стека

### Python:
- Экосистема: Богатый выбор библиотек для ML и обработки изображений
- Производительность: Эффективная работа с ML-моделями
- Разработка: Быстрый цикл разработки и тестирования

### Flask:
- Легковесность: Минимальные накладные расходы
- Гибкость: Простота кастомизации
- Интеграция: Легкая интеграция с ML-компонентами

### TorchXRayVision:
- Специализация: Оптимизирован для медицинских изображений
- Предобученные модели: Готовые модели для рентгеновских снимков
- Точность: Высокая точность на медицинских данных

## API Endpoints

### Prediction Endpoint
POST /api/v1/predict
Content-Type: image/form-data

Parameters:
- image: file (required) - Рентгеновский снимок
### Response Format
{
  "status": "success",
  "prediction": {
    "diagnoses": [
      {
        "condition": "pneumonia",
        "probability": 0.95,
        "severity": "high",
        "regions": [[x1, y1, x2, y2]]
      }
    ],
    "confidence_score": 0.92,
    "processing_time_ms": 234
  },
  "metadata": {
    "model_version": "2.1.0",
    "timestamp": "2023-12-01T12:00:00Z"
  }
}
## Инструкция по установке

## Планы по улучшению системы

### Расширение функциональности моделей

#### Поддержка множественных моделей
- Внедрение ансамблевых методов
  - Voting системы
  - Stacking подход
  - Bagging методы
- Специализированные модели для разных патологий
  - Отдельные модели для COVID-19
  - Специфические модели для онкологии
  - Модели для педиатрии

#### Улучшение производительности
- Оптимизация инференса
  - ONNX Runtime интеграция
  - TensorRT поддержка
  - Квантизация моделей
- Распределенные вычисления
  - Kubernetes оркестрация
  - GPU кластеризация
  - Балансировка нагрузки


### Сетевая архитектура

#### DMZ (Demilitarized Zone)
- Nginx как reverse proxy
  - SSL/TLS терминация
  - Rate limiting
  - Basic auth
- AWS Application Load Balancer
  - Автомасштабирование
  - Health checks
  - SSL/TLS
- Web Application Firewall
  - ModSecurity правила
  - Anti-DDoS защита
  - IP фильтрация

#### Secure Zone
- ML Service
  - Изолированная сеть
  - Доступ только через API Gateway
  - Мониторинг производительности
- Database Cluster
  - Master-Slave репликация
  - Автоматическое резервное копирование
  - Шифрование данных
- Storage Systems
  - Географическое репликация
  - Версионирование
  - Шифрование at rest


### Интеграция с медицинскими системами

#### Поддержка медицинских стандартов
- DICOM интеграция
  - Полная поддержка метаданных
  - PACS интеграция
  - Worklist management
- HL7 совместимость
  - FHIR API поддержка
  - CDA документы
  - ADT сообщения
  
### Расширение списка патологий

#### Новые категории заболеваний
- Интерстициальные заболевания легких
- Плевральные патологии
- Сосудистые нарушения
- Аномалии развития

### Основные разработчики
- Рудаков Никита
  - Lead ML Engineer
  - Архитектура системы
  - ML модели

- Боташев Анзор
  - Backend Developer
  - Frontend
  - Devops

- Люгге Томас
  - Backend Developer
  - Валидация результатов
  - Составление отчетности
### Правовая информация

#### Disclaimer
Система предназначена для использования только в качестве вспомогательного инструмента диагностики. Окончательное решение должно приниматься квалифицированным медицинским специалистом.
